var M=Object.defineProperty,D=Object.defineProperties;var O=Object.getOwnPropertyDescriptors;var y=Object.getOwnPropertySymbols;var $=Object.prototype.hasOwnProperty,K=Object.prototype.propertyIsEnumerable;var N=(e,t,o)=>t in e?M(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,k=(e,t)=>{for(var o in t||(t={}))$.call(t,o)&&N(e,o,t[o]);if(y)for(var o of y(t))K.call(t,o)&&N(e,o,t[o]);return e},A=(e,t)=>D(e,O(t));import{SignIn as j,SignUp as G}from"@clerk/nextjs";import{motion as I,AnimatePresence as Y}from"framer-motion";import{useState as T,useEffect as q}from"react";import{jsx as f,jsxs as R}from"react/jsx-runtime";var fe=({onSuccessRedirect:e="/dashboard"})=>{let[t,o]=T(!1),[s,a]=T("signin");if(q(()=>{o(!0)},[]),!t)return null;let c={elements:{rootBox:"w-full",card:"bg-transparent shadow-none w-full border-none",header:"flex flex-col items-center text-center mb-8",headerTitle:"text-white font-bold text-3xl tracking-tight mb-2 w-full",headerSubtitle:"text-slate-400 text-base font-normal w-full",main:"flex flex-col items-stretch",form:"w-full space-y-6",formFieldRow:"w-full",formField:"flex flex-col items-start w-full",socialButtonsBlockButton:"bg-slate-800/50 hover:bg-slate-700/50 border border-slate-700/50 text-white w-full h-12 rounded-xl transition-all flex justify-center items-center px-6 gap-3",socialButtonsBlockButtonText:"text-white font-medium text-sm",socialButtonsBlockButtonArrow:"hidden",formButtonPrimary:"bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-500 hover:to-indigo-500 text-white h-12 text-sm font-bold w-full rounded-xl transition-all shadow-lg shadow-blue-500/25 active:scale-[0.98] mt-4",footer:"hidden",footerAction:"hidden",identityPreviewText:"text-white font-medium",identityPreviewEditButton:"text-blue-400 hover:text-blue-300 transition-colors",formFieldLabel:"text-slate-300 font-semibold mb-2 text-sm ml-1 w-full text-left",formFieldInput:"bg-slate-950/50 border border-slate-800 text-white focus:border-blue-500/50 focus:ring-1 focus:ring-blue-500/20 h-12 rounded-xl transition-all w-full px-4 text-left placeholder:text-slate-700",dividerLine:"bg-slate-800",dividerText:"text-slate-500 text-[11px] uppercase tracking-[0.2em] font-bold px-4",formFieldInputShowPasswordButton:"text-slate-500 hover:text-white transition-colors mr-2",alert:"bg-red-500/10 border border-red-500/20 rounded-xl p-4 w-full",alertText:"text-red-400 text-sm",formFieldSuccessText:"text-green-400 text-xs mt-1 ml-1 w-full text-left",formFieldErrorText:"text-red-400 text-xs mt-1 ml-1 w-full text-left"}};return f("div",{className:"w-full max-w-[440px]",children:R("div",{className:"bg-slate-900/40 backdrop-blur-3xl border border-slate-800 rounded-[2rem] shadow-2xl relative overflow-hidden",children:[f("div",{className:"p-8 md:p-10",children:f(Y,{mode:"wait",children:s==="signin"?f(I.div,{initial:{opacity:0,scale:.98},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.98},transition:{duration:.2},children:f(j,{appearance:c,routing:"hash",forceRedirectUrl:e})},"signin"):f(I.div,{initial:{opacity:0,scale:.98},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.98},transition:{duration:.2},children:f(G,{appearance:c,routing:"hash",forceRedirectUrl:e})},"signup")})}),f("div",{className:"px-8 py-6 bg-slate-950/40 border-t border-slate-800 flex justify-center",children:R("button",{onClick:()=>a(s==="signin"?"signup":"signin"),className:"text-sm font-medium text-slate-400 hover:text-white transition-all flex items-center gap-2 group",children:[s==="signin"?"New to Reflecter? Create account":"Already registered? Sign in",f("span",{className:"group-hover:translate-x-1 transition-transform",children:"\u2192"})]})})]})})};import{useAuth as X}from"@clerk/nextjs";import{useGetWallet as z,useCreateWallet as H}from"@chipi-stack/nextjs";import{useEffect as C,useState as L,useMemo as J}from"react";var v=()=>{let{userId:e,orgId:t,getToken:o,isLoaded:s}=X(),[a,c]=L(null),[i,x]=L(!1),n=J(()=>e?t?`${e}_${t}`:e:null,[e,t]),{data:u,isLoading:m,error:g,refetch:l}=z({params:{externalUserId:n||""},getBearerToken:async()=>a}),{createWalletAsync:b}=H();return C(()=>{(async()=>{if(s&&e)try{let p=await o();c(p)}catch(p){console.error("Error fetching Clerk token:",p)}})()},[s,e,o]),C(()=>{(async()=>{if(s&&e&&a&&!u&&!m&&!g&&!i){x(!0);try{console.log("Auto-creating wallet for:",n),await b({params:{externalUserId:n,encryptKey:`enc_${n}`},bearerToken:a}),l()}catch(p){console.error("Auto-creation failed:",p)}finally{x(!1)}}})()},[s,e,a,u,m,g,i,b,n,l]),{wallet:u?A(k({},u),{address:u.publicKey,compositeId:n}):null,isLoading:m||!s||e&&!a||i,error:g,refetch:()=>{l()},compositeId:n}};import{Copy as Q,Check as V,ExternalLink as Z,Loader2 as ee,Link2 as te,Unlink as re,Code2 as oe}from"lucide-react";import{useState as E,useEffect as se}from"react";import{motion as ne}from"framer-motion";import{jsx as r,jsxs as d}from"react/jsx-runtime";var Te=()=>{let{wallet:e,isLoading:t,error:o}=v(),[s,a]=E(!1),[c,i]=E(!0);se(()=>{if(typeof window=="undefined")return;i(navigator.onLine);let n=()=>i(!0),u=()=>i(!1);return window.addEventListener("online",n),window.addEventListener("offline",u),()=>{window.removeEventListener("online",n),window.removeEventListener("offline",u)}},[]);let x=()=>{e!=null&&e.address&&(navigator.clipboard.writeText(e.address),a(!0),setTimeout(()=>a(!1),2e3))};return t?r("div",{className:"bg-slate-900/50 backdrop-blur-md border border-slate-800 p-6 rounded-2xl flex items-center justify-center min-h-[200px]",children:r(ee,{className:"w-8 h-8 text-blue-500 animate-spin"})}):o?d("div",{className:"bg-red-500/10 border border-red-500/20 p-6 rounded-2xl text-red-100 italic",children:["Error deriving Smart Wallet: ",o.message]}):d(ne.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"bg-slate-900/40 backdrop-blur-xl border border-slate-800/60 p-8 rounded-3xl shadow-xl relative overflow-hidden group",children:[r("div",{className:"absolute top-0 right-0 w-32 h-32 bg-blue-500/10 blur-3xl rounded-full group-hover:bg-blue-500/20 transition-colors duration-500"}),d("div",{className:"flex justify-between items-start mb-6",children:[d("div",{children:[r("h3",{className:"text-slate-400 text-sm font-medium uppercase tracking-wider mb-1",children:"Starknet Smart Wallet"}),d("div",{className:"flex items-center gap-2",children:[r("span",{className:`w-2 h-2 rounded-full ${c?"bg-green-500 shadow-[0_0_8px_rgba(34,197,94,0.6)]":"bg-red-500 shadow-[0_0_8px_rgba(239,68,68,0.6)]"}`}),r("span",{className:"text-xs text-slate-500 font-mono",children:c?"Network Online":"Offline Mode"})]})]}),r("div",{className:"p-3 bg-blue-500/10 rounded-2xl border border-blue-500/20",children:c?r(te,{className:"w-5 h-5 text-blue-400"}):r(re,{className:"w-5 h-5 text-slate-500"})})]}),d("div",{className:"space-y-4",children:[d("div",{className:"p-4 bg-slate-950/50 border border-slate-800 rounded-2xl",children:[r("label",{className:"block text-[10px] text-slate-500 font-bold uppercase mb-2 ml-1",children:"Wallet Address"}),d("div",{className:"flex items-center gap-3",children:[r("div",{className:"flex-1 font-mono text-sm text-slate-100 truncate",children:(e==null?void 0:e.address)||"Deriving address..."}),r("button",{onClick:x,className:"p-2 hover:bg-slate-800 rounded-xl transition-colors text-slate-400 hover:text-slate-100",children:s?r(V,{className:"w-4 h-4 text-green-400"}):r(Q,{className:"w-4 h-4"})})]})]}),d("div",{className:"p-4 bg-slate-950/20 border border-slate-800/50 rounded-2xl border-dashed",children:[r("label",{className:"block text-[10px] text-slate-400/50 font-bold uppercase mb-1 ml-1",children:"Composite Application ID"}),d("div",{className:"flex items-center gap-2",children:[r(oe,{className:"w-3 h-3 text-slate-600"}),r("div",{className:"flex-1 font-mono text-[10px] text-slate-500 truncate",children:e?e.compositeId||"N/A":"..."})]})]}),r("div",{className:"flex gap-3",children:d("a",{href:`https://starkscan.co/contract/${e==null?void 0:e.address}`,target:"_blank",rel:"noopener noreferrer",className:"flex-1 flex items-center justify-center gap-2 py-3 bg-slate-800 hover:bg-slate-700 text-slate-100 text-sm font-medium rounded-2xl transition-all border border-slate-700/50",children:["Explorer ",r(Z,{className:"w-3 h-3"})]})})]}),r("div",{className:"mt-6 pt-6 border-t border-slate-800/50",children:r("p",{className:"text-[11px] text-slate-500 text-center leading-relaxed",children:"This wallet is unique to your account and persistent across sessions. Powered by Chipi Pay SDK."})})]})};import{useEffect as ae,useState as S,useCallback as ie}from"react";import{Contract as W,Account as le,RpcProvider as _}from"starknet";import{IDENTITY_REGISTRY_ABI as B,CONTRACTS as P,MAINNET_RPC_URL as U}from"@optz/shared-configs";var Pe=()=>{let{wallet:e,isLoading:t,error:o,refetch:s}=v(),[a,c]=S(null),[i,x]=S(!1),n=ie(async()=>{if(e!=null&&e.address)try{let m=new _({nodeUrl:U}),g=P.mainnet.identityRegistry;if(g==="0x0000000000000000000000000000000000000000000000000000000000000000"){console.warn("Identity Registry address is placeholder. Skipping check.");return}let l=new W(B,g,m);console.log("Checking 8004 registration on MAINNET for:",e.address)}catch(m){console.error("Error checking registration:",m)}},[e==null?void 0:e.address]),u=async(m,g=[])=>{if(!(!e||i)){x(!0);try{let l=new _({nodeUrl:U}),b=P.mainnet.identityRegistry;if(b==="0x0000000000000000000000000000000000000000000000000000000000000000")throw new Error("Identity Registry address is placeholder. Please configure it in shared-configs.");let h=new le(l,e.address,e.privateKey),p=new W(B,b,l);p.connect(h),console.log("Registering agent in 8004 registry on MAINNET...");let F=p.populate("register_with_metadata",[m,g]),{transaction_hash:w}=await h.execute(F);console.log("Registration TX sent:",w),await l.waitForTransaction(w),c("1")}catch(l){throw console.error("8004 Registration failed:",l),l}finally{x(!1)}}};return ae(()=>{e!=null&&e.address&&n()},[e==null?void 0:e.address,n]),{wallet:e,agentId:a,isLoading:t||i,isRegistering:i,error:o,registerAgent:u,refetch:s}};export{fe as SocialLogin,Te as WalletCard,Pe as useAgentWallet,v as useFetchWallet};
