"use strict";var R=Object.defineProperty,D=Object.defineProperties,O=Object.getOwnPropertyDescriptor,$=Object.getOwnPropertyDescriptors,K=Object.getOwnPropertyNames,S=Object.getOwnPropertySymbols;var _=Object.prototype.hasOwnProperty,j=Object.prototype.propertyIsEnumerable;var W=(e,r,o)=>r in e?R(e,r,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[r]=o,B=(e,r)=>{for(var o in r||(r={}))_.call(r,o)&&W(e,o,r[o]);if(S)for(var o of S(r))j.call(r,o)&&W(e,o,r[o]);return e},P=(e,r)=>D(e,$(r));var G=(e,r)=>{for(var o in r)R(e,o,{get:r[o],enumerable:!0})},Y=(e,r,o,n)=>{if(r&&typeof r=="object"||typeof r=="function")for(let s of K(r))!_.call(e,s)&&s!==o&&R(e,s,{get:()=>r[s],enumerable:!(n=O(r,s))||n.enumerable});return e};var q=e=>Y(R({},"__esModule",{value:!0}),e);var J={};G(J,{SocialLogin:()=>X,WalletCard:()=>z,useAgentWallet:()=>H,useFetchWallet:()=>A});module.exports=q(J);var C=require("@clerk/nextjs"),N=require("framer-motion"),k=require("react"),l=require("react/jsx-runtime"),X=({onSuccessRedirect:e="/dashboard"})=>{let[r,o]=(0,k.useState)(!1),[n,s]=(0,k.useState)("signin");if((0,k.useEffect)(()=>{o(!0)},[]),!r)return null;let u={elements:{rootBox:"w-full",card:"bg-transparent shadow-none w-full border-none",header:"flex flex-col items-center text-center mb-8",headerTitle:"text-white font-bold text-3xl tracking-tight mb-2 w-full",headerSubtitle:"text-slate-400 text-base font-normal w-full",main:"flex flex-col items-stretch",form:"w-full space-y-6",formFieldRow:"w-full",formField:"flex flex-col items-start w-full",socialButtonsBlockButton:"bg-slate-800/50 hover:bg-slate-700/50 border border-slate-700/50 text-white w-full h-12 rounded-xl transition-all flex justify-center items-center px-6 gap-3",socialButtonsBlockButtonText:"text-white font-medium text-sm",socialButtonsBlockButtonArrow:"hidden",formButtonPrimary:"bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-500 hover:to-indigo-500 text-white h-12 text-sm font-bold w-full rounded-xl transition-all shadow-lg shadow-blue-500/25 active:scale-[0.98] mt-4",footer:"hidden",footerAction:"hidden",identityPreviewText:"text-white font-medium",identityPreviewEditButton:"text-blue-400 hover:text-blue-300 transition-colors",formFieldLabel:"text-slate-300 font-semibold mb-2 text-sm ml-1 w-full text-left",formFieldInput:"bg-slate-950/50 border border-slate-800 text-white focus:border-blue-500/50 focus:ring-1 focus:ring-blue-500/20 h-12 rounded-xl transition-all w-full px-4 text-left placeholder:text-slate-700",dividerLine:"bg-slate-800",dividerText:"text-slate-500 text-[11px] uppercase tracking-[0.2em] font-bold px-4",formFieldInputShowPasswordButton:"text-slate-500 hover:text-white transition-colors mr-2",alert:"bg-red-500/10 border border-red-500/20 rounded-xl p-4 w-full",alertText:"text-red-400 text-sm",formFieldSuccessText:"text-green-400 text-xs mt-1 ml-1 w-full text-left",formFieldErrorText:"text-red-400 text-xs mt-1 ml-1 w-full text-left"}};return(0,l.jsx)("div",{className:"w-full max-w-[440px]",children:(0,l.jsxs)("div",{className:"bg-slate-900/40 backdrop-blur-3xl border border-slate-800 rounded-[2rem] shadow-2xl relative overflow-hidden",children:[(0,l.jsx)("div",{className:"p-8 md:p-10",children:(0,l.jsx)(N.AnimatePresence,{mode:"wait",children:n==="signin"?(0,l.jsx)(N.motion.div,{initial:{opacity:0,scale:.98},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.98},transition:{duration:.2},children:(0,l.jsx)(C.SignIn,{appearance:u,routing:"hash",forceRedirectUrl:e})},"signin"):(0,l.jsx)(N.motion.div,{initial:{opacity:0,scale:.98},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.98},transition:{duration:.2},children:(0,l.jsx)(C.SignUp,{appearance:u,routing:"hash",forceRedirectUrl:e})},"signup")})}),(0,l.jsx)("div",{className:"px-8 py-6 bg-slate-950/40 border-t border-slate-800 flex justify-center",children:(0,l.jsxs)("button",{onClick:()=>s(n==="signin"?"signup":"signin"),className:"text-sm font-medium text-slate-400 hover:text-white transition-all flex items-center gap-2 group",children:[n==="signin"?"New to Reflecter? Create account":"Already registered? Sign in",(0,l.jsx)("span",{className:"group-hover:translate-x-1 transition-transform",children:"\u2192"})]})})]})})};var U=require("@clerk/nextjs"),L=require("@chipi-stack/nextjs"),b=require("react");var A=()=>{let{userId:e,orgId:r,getToken:o,isLoaded:n}=(0,U.useAuth)(),[s,u]=(0,b.useState)(null),[d,v]=(0,b.useState)(!1),i=(0,b.useMemo)(()=>e?r?`${e}_${r}`:e:null,[e,r]),{data:m,isLoading:f,error:p,refetch:c}=(0,L.useGetWallet)({params:{externalUserId:i||""},getBearerToken:async()=>s}),{createWalletAsync:y}=(0,L.useCreateWallet)();return(0,b.useEffect)(()=>{(async()=>{if(n&&e)try{let x=await o();u(x)}catch(x){console.error("Error fetching Clerk token:",x)}})()},[n,e,o]),(0,b.useEffect)(()=>{(async()=>{if(n&&e&&s&&!m&&!f&&!p&&!d){v(!0);try{console.log("Auto-creating wallet for:",i),await y({params:{externalUserId:i,encryptKey:`enc_${i}`},bearerToken:s}),c()}catch(x){console.error("Auto-creation failed:",x)}finally{v(!1)}}})()},[n,e,s,m,f,p,d,y,i,c]),{wallet:m?P(B({},m),{address:m.publicKey,compositeId:i}):null,isLoading:f||!n||e&&!s||d,error:p,refetch:()=>{c()},compositeId:i}};var a=require("lucide-react"),I=require("react"),F=require("framer-motion"),t=require("react/jsx-runtime"),z=()=>{let{wallet:e,isLoading:r,error:o}=A(),[n,s]=(0,I.useState)(!1),[u,d]=(0,I.useState)(!0);(0,I.useEffect)(()=>{if(typeof window=="undefined")return;d(navigator.onLine);let i=()=>d(!0),m=()=>d(!1);return window.addEventListener("online",i),window.addEventListener("offline",m),()=>{window.removeEventListener("online",i),window.removeEventListener("offline",m)}},[]);let v=()=>{e!=null&&e.address&&(navigator.clipboard.writeText(e.address),s(!0),setTimeout(()=>s(!1),2e3))};return r?(0,t.jsx)("div",{className:"bg-slate-900/50 backdrop-blur-md border border-slate-800 p-6 rounded-2xl flex items-center justify-center min-h-[200px]",children:(0,t.jsx)(a.Loader2,{className:"w-8 h-8 text-blue-500 animate-spin"})}):o?(0,t.jsxs)("div",{className:"bg-red-500/10 border border-red-500/20 p-6 rounded-2xl text-red-100 italic",children:["Error deriving Smart Wallet: ",o.message]}):(0,t.jsxs)(F.motion.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"bg-slate-900/40 backdrop-blur-xl border border-slate-800/60 p-8 rounded-3xl shadow-xl relative overflow-hidden group",children:[(0,t.jsx)("div",{className:"absolute top-0 right-0 w-32 h-32 bg-blue-500/10 blur-3xl rounded-full group-hover:bg-blue-500/20 transition-colors duration-500"}),(0,t.jsxs)("div",{className:"flex justify-between items-start mb-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-slate-400 text-sm font-medium uppercase tracking-wider mb-1",children:"Starknet Smart Wallet"}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:`w-2 h-2 rounded-full ${u?"bg-green-500 shadow-[0_0_8px_rgba(34,197,94,0.6)]":"bg-red-500 shadow-[0_0_8px_rgba(239,68,68,0.6)]"}`}),(0,t.jsx)("span",{className:"text-xs text-slate-500 font-mono",children:u?"Network Online":"Offline Mode"})]})]}),(0,t.jsx)("div",{className:"p-3 bg-blue-500/10 rounded-2xl border border-blue-500/20",children:u?(0,t.jsx)(a.Link2,{className:"w-5 h-5 text-blue-400"}):(0,t.jsx)(a.Unlink,{className:"w-5 h-5 text-slate-500"})})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"p-4 bg-slate-950/50 border border-slate-800 rounded-2xl",children:[(0,t.jsx)("label",{className:"block text-[10px] text-slate-500 font-bold uppercase mb-2 ml-1",children:"Wallet Address"}),(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"flex-1 font-mono text-sm text-slate-100 truncate",children:(e==null?void 0:e.address)||"Deriving address..."}),(0,t.jsx)("button",{onClick:v,className:"p-2 hover:bg-slate-800 rounded-xl transition-colors text-slate-400 hover:text-slate-100",children:n?(0,t.jsx)(a.Check,{className:"w-4 h-4 text-green-400"}):(0,t.jsx)(a.Copy,{className:"w-4 h-4"})})]})]}),(0,t.jsxs)("div",{className:"p-4 bg-slate-950/20 border border-slate-800/50 rounded-2xl border-dashed",children:[(0,t.jsx)("label",{className:"block text-[10px] text-slate-400/50 font-bold uppercase mb-1 ml-1",children:"Composite Application ID"}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(a.Code2,{className:"w-3 h-3 text-slate-600"}),(0,t.jsx)("div",{className:"flex-1 font-mono text-[10px] text-slate-500 truncate",children:e?e.compositeId||"N/A":"..."})]})]}),(0,t.jsx)("div",{className:"flex gap-3",children:(0,t.jsxs)("a",{href:`https://starkscan.co/contract/${e==null?void 0:e.address}`,target:"_blank",rel:"noopener noreferrer",className:"flex-1 flex items-center justify-center gap-2 py-3 bg-slate-800 hover:bg-slate-700 text-slate-100 text-sm font-medium rounded-2xl transition-all border border-slate-700/50",children:["Explorer ",(0,t.jsx)(a.ExternalLink,{className:"w-3 h-3"})]})})]}),(0,t.jsx)("div",{className:"mt-6 pt-6 border-t border-slate-800/50",children:(0,t.jsx)("p",{className:"text-[11px] text-slate-500 text-center leading-relaxed",children:"This wallet is unique to your account and persistent across sessions. Powered by Chipi Pay SDK."})})]})};var w=require("react");var h=require("starknet"),g=require("@optz/shared-configs"),H=()=>{let{wallet:e,isLoading:r,error:o,refetch:n}=A(),[s,u]=(0,w.useState)(null),[d,v]=(0,w.useState)(!1),i=(0,w.useCallback)(async()=>{if(e!=null&&e.address)try{let f=new h.RpcProvider({nodeUrl:g.MAINNET_RPC_URL}),p=g.CONTRACTS.mainnet.identityRegistry;if(p==="0x0000000000000000000000000000000000000000000000000000000000000000"){console.warn("Identity Registry address is placeholder. Skipping check.");return}let c=new h.Contract(g.IDENTITY_REGISTRY_ABI,p,f);console.log("Checking 8004 registration on MAINNET for:",e.address)}catch(f){console.error("Error checking registration:",f)}},[e==null?void 0:e.address]),m=async(f,p=[])=>{if(!(!e||d)){v(!0);try{let c=new h.RpcProvider({nodeUrl:g.MAINNET_RPC_URL}),y=g.CONTRACTS.mainnet.identityRegistry;if(y==="0x0000000000000000000000000000000000000000000000000000000000000000")throw new Error("Identity Registry address is placeholder. Please configure it in shared-configs.");let T=new h.Account(c,e.address,e.privateKey),x=new h.Contract(g.IDENTITY_REGISTRY_ABI,y,c);x.connect(T),console.log("Registering agent in 8004 registry on MAINNET...");let M=x.populate("register_with_metadata",[f,p]),{transaction_hash:E}=await T.execute(M);console.log("Registration TX sent:",E),await c.waitForTransaction(E),u("1")}catch(c){throw console.error("8004 Registration failed:",c),c}finally{v(!1)}}};return(0,w.useEffect)(()=>{e!=null&&e.address&&i()},[e==null?void 0:e.address,i]),{wallet:e,agentId:s,isLoading:r||d,isRegistering:d,error:o,registerAgent:m,refetch:n}};0&&(module.exports={SocialLogin,WalletCard,useAgentWallet,useFetchWallet});
